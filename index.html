<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿä - ÿßŸÑŸÑÿπÿ®ÿ© ÿßŸÑŸÉÿßŸÖŸÑÿ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ===== ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑ ŸàÿßŸÑÿ™ÿ£ÿ≥Ÿäÿ≥ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #0a1931 0%, #1e3a8a 100%);
            color: white;
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }

        /* ===== ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ===== */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a1931 0%, #1e3a8a 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loader {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.5rem;
            color: #FFD700;
            margin-top: 10px;
            text-align: center;
        }

        #app {
            display: none;
            width: 100%;
            min-height: 100vh;
        }

        /* ===== ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ ===== */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: inherit;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 100;
            overflow-y: auto;
        }

        .screen.active {
            display: flex;
        }

        /* ===== ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ/ÿßŸÑÿØÿÆŸàŸÑ ===== */
        .auth-box {
            background: rgba(30, 39, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            border: 3px solid #FFD700;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: #FFD700;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: #FFD700;
            border-bottom-color: #FFD700;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #FFD700;
            font-weight: 500;
            font-size: 1.1rem;
        }

        .form-control {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 15px;
            color: white;
            font-size: 1rem;
            font-family: inherit;
            transition: 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        /* ===== ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ===== */
        .btn {
            padding: 18px 35px;
            border: none;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #D4AF37, #FFD700);
            color: black;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #ff6b6b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.4);
        }

        /* ===== ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ===== */
        .menu-container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
        }

        .user-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .user-welcome {
            font-size: 2.8rem;
            color: #FFD700;
            margin-bottom: 15px;
        }

        .user-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            min-width: 180px;
            transition: 0.3s;
            border: 2px solid transparent;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            border-color: #FFD700;
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            color: #FFD700;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #FFD700;
            font-size: 1rem;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .menu-card {
            background: rgba(30, 39, 46, 0.9);
            border-radius: 25px;
            padding: 35px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            border: 3px solid transparent;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .menu-card:hover {
            transform: translateY(-8px);
            border-color: #FFD700;
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.2);
        }

        .menu-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #FFD700;
        }

        .menu-card h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.7rem;
        }

        .menu-card p {
            color: #aaa;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        /* ===== ÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÑÿπÿ®ÿ© ===== */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(30, 39, 46, 0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 1000px;
            flex-wrap: wrap;
            gap: 20px;
            border: 2px solid #FFD700;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .player-avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, #D4AF37, #FFD700);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: black;
            font-weight: bold;
        }

        .game-stats {
            display: flex;
            gap: 35px;
            flex-wrap: wrap;
        }

        .stat-box {
            text-align: center;
            min-width: 120px;
        }

        .stat-box .stat-label {
            color: #FFD700;
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .stat-box .stat-value {
            font-size: 2rem;
            color: #FFD700;
            font-weight: bold;
        }

        .question-box {
            background: rgba(30, 39, 46, 0.95);
            padding: 45px;
            border-radius: 25px;
            width: 100%;
            max-width: 900px;
            margin-bottom: 40px;
            text-align: center;
            border: 3px solid #FFD700;
        }

        .question-text {
            font-size: 2rem;
            margin: 40px 0;
            line-height: 1.8;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 40px 0;
        }

        @media (max-width: 768px) {
            .answers-grid {
                grid-template-columns: 1fr;
            }
        }

        .answer-btn {
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
            text-align: right;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .answer-btn:hover:not(:disabled) {
            background: rgba(212, 175, 55, 0.15);
            border-color: #FFD700;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .answer-btn.correct {
            background: rgba(39, 174, 96, 0.25);
            border-color: #27ae60;
        }

        .answer-btn.wrong {
            background: rgba(231, 76, 60, 0.25);
            border-color: #e74c3c;
        }

        .answer-letter {
            width: 50px;
            height: 50px;
            background: #FFD700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: black;
            flex-shrink: 0;
            font-size: 1.3rem;
        }

        .answer-btn.correct .answer-letter {
            background: #27ae60;
            color: white;
        }

        .answer-btn.wrong .answer-letter {
            background: #e74c3c;
            color: white;
        }

        /* ===== ÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ===== */
        .results-container {
            background: rgba(30, 39, 46, 0.95);
            border-radius: 25px;
            padding: 50px;
            max-width: 700px;
            width: 100%;
            border: 3px solid #FFD700;
            text-align: center;
        }

        .result-icon {
            font-size: 6rem;
            margin-bottom: 30px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin: 40px 0;
        }

        .result-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #FFD700;
        }

        /* ===== ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ===== */
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: rgba(30, 39, 46, 0.98);
            padding: 25px;
            border-radius: 15px;
            border-right: 6px solid #FFD700;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.4s;
            max-width: 450px;
            backdrop-filter: blur(10px);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-right-color: #27ae60;
        }

        .notification.error {
            border-right-color: #e74c3c;
        }

        .notification.warning {
            border-right-color: #f39c12;
        }

        .notification.info {
            border-right-color: #3498db;
        }

        /* ===== ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ© ===== */
        .admin-screen {
            padding: 25px;
            background: rgba(30, 39, 46, 0.95);
            min-height: 100vh;
            width: 100%;
            overflow-y: auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 3px solid #FFD700;
            flex-wrap: wrap;
            gap: 20px;
        }

        .admin-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1.1rem;
        }

        .admin-tab.active {
            background: #FFD700;
            color: black;
            font-weight: 600;
        }

        .admin-content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 35px;
            min-height: 600px;
        }

        /* ===== ÿ™ÿÆÿµŸäÿµ ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ===== */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #FFD700;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #D4AF37;
        }

        /* ===== ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿÆÿßÿµÿ© ===== */
        .flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3000;
            animation: flashEffect 1s;
        }

        @keyframes flashEffect {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .flash.correct {
            background: radial-gradient(circle, rgba(39, 174, 96, 0.6) 0%, transparent 70%);
        }

        .flash.wrong {
            background: radial-gradient(circle, rgba(231, 76, 60, 0.6) 0%, transparent 70%);
        }

        /* ===== ÿ™ÿµŸÖŸäŸÖ ŸÖÿ™ÿ¨ÿßŸàÿ® ===== */
        @media (max-width: 768px) {
            .auth-box {
                padding: 30px 25px;
                margin: 15px;
            }
            
            .question-box {
                padding: 30px 25px;
            }
            
            .game-header {
                flex-direction: column;
                text-align: center;
            }
            
            .game-stats {
                justify-content: center;
            }
            
            .results-stats {
                grid-template-columns: 1fr;
            }
            
            .user-stats {
                gap: 15px;
            }
            
            .stat-item {
                min-width: 140px;
                padding: 20px;
            }
            
            .menu-card {
                padding: 25px;
            }
            
            .notification {
                left: 15px;
                right: 15px;
                max-width: calc(100% - 30px);
            }
        }

        @media (max-width: 480px) {
            .user-welcome {
                font-size: 2.2rem;
            }
            
            .question-text {
                font-size: 1.6rem;
            }
            
            .answer-btn {
                padding: 20px;
                font-size: 1.1rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
    <div id="loading">
        <div class="loader"></div>
        <div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿä...</div>
        <div style="margin-top: 30px; text-align: center;">
            <button id="skip-loading" style="
                background: #FFD700;
                color: black;
                border: none;
                padding: 15px 35px;
                border-radius: 25px;
                font-weight: bold;
                cursor: pointer;
                font-size: 1.1rem;
                margin-top: 20px;">
                ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            </button>
        </div>
    </div>

    <!-- ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
    <div id="app"></div>

    <!-- ÿ¨ŸÖŸäÿπ ÿ£ŸÉŸàÿßÿØ JavaScript -->
    <script>
        // ===== GameConfig =====
        const GameConfig = {
            VERSION: '2.0.0',
            APP_NAME: "ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿä",
            CURRENCY_SYMBOL: '$',
            MAX_QUESTIONS: 15,
            PRIZES: [100, 200, 300, 500, 1000, 2000, 5000, 10000, 16000, 32000, 64000, 128000, 256000, 500000, 1000000],
            SAFE_HAVENS: [5, 10],
            INITIAL_BALANCE: 1000,
            INITIAL_LIFELINES: 3,
            CATEGORIES: [
                { id: 'general', name: 'ÿπÿßŸÖ', color: '#3498db' },
                { id: 'history', name: 'ÿ™ÿßÿ±ŸäÿÆ', color: '#e74c3c' },
                { id: 'geography', name: 'ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿß', color: '#2ecc71' },
                { id: 'science', name: 'ÿπŸÑŸàŸÖ', color: '#9b59b6' },
                { id: 'sports', name: 'ÿ±Ÿäÿßÿ∂ÿ©', color: '#e67e22' },
                { id: 'entertainment', name: 'ÿ™ÿ±ŸÅŸäŸá', color: '#1abc9c' }
            ],
            DIFFICULTY_LEVELS: [
                { id: 'easy', name: 'ÿ≥ŸáŸÑ', time: 60, lifelines: 3 },
                { id: 'medium', name: 'ŸÖÿ™Ÿàÿ≥ÿ∑', time: 45, lifelines: 2 },
                { id: 'hard', name: 'ÿµÿπÿ®', time: 30, lifelines: 1 }
            ],
            STORAGE_KEYS: {
                USERS: 'millionaire_users_v2',
                SESSION: 'millionaire_session_v2',
                QUESTIONS: 'millionaire_questions_v2'
            },
            SECURITY: {
                USERNAME_MIN_LENGTH: 3,
                USERNAME_MAX_LENGTH: 20,
                PASSWORD_MIN_LENGTH: 6,
                SESSION_TIMEOUT: 7 * 24 * 60 * 60 * 1000
            }
        };

        // ===== AuthSystem =====
        class AuthSystem {
            constructor() {
                this.currentUser = null;
                this.users = this.loadUsers();
                this.init();
            }

            init() {
                this.checkAutoLogin();
                console.log("‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿµÿßÿØŸÇÿ© ÿ¨ÿßŸáÿ≤");
            }

            loadUsers() {
                try {
                    const usersData = localStorage.getItem(GameConfig.STORAGE_KEYS.USERS);
                    return usersData ? JSON.parse(usersData) : {};
                } catch (error) {
                    console.error("‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:", error);
                    return {};
                }
            }

            saveUsers() {
                try {
                    localStorage.setItem(GameConfig.STORAGE_KEYS.USERS, JSON.stringify(this.users));
                    return true;
                } catch (error) {
                    console.error("‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:", error);
                    return false;
                }
            }

            register(username, password, email = "", isAdmin = false) {
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™
                if (!username || username.trim().length < GameConfig.SECURITY.USERNAME_MIN_LENGTH) {
                    return { success: false, message: `ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ${GameConfig.SECURITY.USERNAME_MIN_LENGTH} ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ` };
                }

                if (username.trim().length > GameConfig.SECURITY.USERNAME_MAX_LENGTH) {
                    return { success: false, message: `ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ Ÿäÿ¨ÿ® ÿ£ŸÑÿß Ÿäÿ™ÿ¨ÿßŸàÿ≤ ${GameConfig.SECURITY.USERNAME_MAX_LENGTH} ÿ£ÿ≠ÿ±ŸÅ` };
                }

                if (!password || password.length < GameConfig.SECURITY.PASSWORD_MIN_LENGTH) {
                    return { success: false, message: `ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ${GameConfig.SECURITY.PASSWORD_MIN_LENGTH} ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ` };
                }

                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿπÿØŸÖ Ÿàÿ¨ŸàÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿßÿ≥ŸÖ
                if (this.users[username]) {
                    return { success: false, message: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã' };
                }

                // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ
                const newUser = {
                    id: 'user_' + Date.now(),
                    username: username.trim(),
                    password: this.hashPassword(password),
                    email: email.trim(),
                    isAdmin: isAdmin,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    stats: {
                        gamesPlayed: 0,
                        totalWinnings: 0,
                        correctAnswers: 0,
                        totalQuestions: 0,
                        highestScore: 0,
                        level: 1,
                        xp: 0,
                        xpToNextLevel: 1000
                    },
                    settings: {
                        sound: true,
                        music: true,
                        theme: 'dark',
                        language: 'ar'
                    },
                    balance: GameConfig.INITIAL_BALANCE,
                    lifelines: GameConfig.INITIAL_LIFELINES
                };

                // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                this.users[username] = newUser;
                const saved = this.saveUsers();

                if (!saved) {
                    return { success: false, message: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™' };
                }

                // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                return this.login(username, password);
            }

            login(username, password) {
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                const user = this.users[username];
                if (!user) {
                    return { success: false, message: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©' };
                }

                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
                const hashedPassword = this.hashPassword(password);
                if (user.password !== hashedPassword) {
                    return { success: false, message: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©' };
                }

                // ÿ™ÿ≠ÿØŸäÿ´ ŸàŸÇÿ™ ÿ¢ÿÆÿ± ÿØÿÆŸàŸÑ
                user.lastLogin = new Date().toISOString();
                this.users[username] = user;
                this.saveUsers();

                // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©
                this.currentUser = user;
                this.saveSession(user);

                console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ: ${username}`);
                return { success: true, message: 'ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠', user: user };
            }

            logout() {
                this.clearSession();
                this.currentUser = null;
                console.log(`‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨`);
                return { success: true, message: 'ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠' };
            }

            checkAutoLogin() {
                try {
                    const sessionData = localStorage.getItem(GameConfig.STORAGE_KEYS.SESSION);
                    if (sessionData) {
                        const session = JSON.parse(sessionData);
                        const user = this.users[session.username];
                        const sessionAge = Date.now() - session.timestamp;
                        const sessionValid = sessionAge < GameConfig.SECURITY.SESSION_TIMEOUT;

                        if (user && sessionValid) {
                            this.currentUser = user;
                            return true;
                        } else {
                            this.clearSession();
                        }
                    }
                } catch (error) {
                    console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ¨ŸÑÿ≥ÿ©:', error);
                }
                return false;
            }

            saveSession(user) {
                const session = { username: user.username, timestamp: Date.now() };
                localStorage.setItem(GameConfig.STORAGE_KEYS.SESSION, JSON.stringify(session));
            }

            clearSession() {
                localStorage.removeItem(GameConfig.STORAGE_KEYS.SESSION);
            }

            updateUser(username, updates) {
                if (!this.users[username]) return false;
                this.users[username] = { ...this.users[username], ...updates };
                if (this.currentUser && this.currentUser.username === username) {
                    this.currentUser = this.users[username];
                }
                return this.saveUsers();
            }

            hashPassword(password) {
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(36) + password.length.toString();
            }

            getCurrentUser() { return this.currentUser; }
            isLoggedIn() { return this.currentUser !== null; }
            isAdmin() { return this.currentUser && this.currentUser.isAdmin === true; }

            updateBalance(username, amount) {
                const user = this.users[username];
                if (!user) return false;
                user.balance += amount;
                if (user.balance < 0) user.balance = 0;
                return this.updateUser(username, { balance: user.balance });
            }

            getAllUsers() { return Object.values(this.users); }
        }

        // ===== QuestionManager =====
        class QuestionManager {
            constructor() {
                this.categories = {};
                this.usedQuestions = new Set();
                this.initializeCategories();
                this.loadQuestions();
                console.log('‚úÖ ŸÖÿØŸäÿ± ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¨ÿßŸáÿ≤');
            }

            initializeCategories() {
                GameConfig.CATEGORIES.forEach(category => {
                    this.categories[category.id] = {
                        ...category,
                        questions: { easy: [], medium: [], hard: [] }
                    };
                });
            }

            loadQuestions() {
                try {
                    const saved = localStorage.getItem(GameConfig.STORAGE_KEYS.QUESTIONS);
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.categories = data.categories || this.categories;
                        console.log('‚úÖ ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©');
                        return;
                    }
                } catch (error) {
                    console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©:', error);
                }
                this.createDefaultQuestions();
            }

            createDefaultQuestions() {
                // ÿ£ÿ≥ÿ¶ŸÑÿ© ÿπÿßŸÖÿ©
                this.addQuestions('general', 'easy', [
                    { question: 'ŸÖÿß ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿßÿü', answers: ['ÿ±ŸàŸÖÿß', 'ÿ®ÿßÿ±Ÿäÿ≥', 'ÿ®ÿ±ŸÑŸäŸÜ', 'ŸÑŸÜÿØŸÜ'], correct: 1, hint: 'ÿ™ÿ¥ÿ™Ÿáÿ± ÿ®ÿ®ÿ±ÿ¨ ÿ•ŸäŸÅŸÑ', explanation: 'ÿ®ÿßÿ±Ÿäÿ≥ ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿß' },
                    { question: 'ŸÉŸÖ ÿπÿØÿØ ÿ£ŸäÿßŸÖ ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπÿü', answers: ['5', '6', '7', '8'], correct: 2, hint: 'ÿ±ŸÇŸÖ ÿ´ÿßÿ®ÿ™ ŸÅŸä ÿ¨ŸÖŸäÿπ ÿßŸÑÿ´ŸÇÿßŸÅÿßÿ™', explanation: 'ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ Ÿäÿ™ŸÉŸàŸÜ ŸÖŸÜ 7 ÿ£ŸäÿßŸÖ' },
                    { question: 'ŸÖÿß ŸáŸà ŸÑŸàŸÜ ÿßŸÑÿ™ŸÅÿßÿ≠ÿ© ÿßŸÑŸÜÿßÿ∂ÿ¨ÿ©ÿü', answers: ['ÿ®ÿ±ÿ™ŸÇÿßŸÑŸä', 'ÿ£ÿµŸÅÿ±', 'ÿ£ÿ≠ŸÖÿ±', 'ÿ£ÿÆÿ∂ÿ±'], correct: 2, hint: 'ŸÑŸàŸÜ ÿ¥ÿßÿ¶ÿπ ŸÑŸÑŸÅŸàÿßŸÉŸá', explanation: 'ŸÖÿπÿ∏ŸÖ ÿßŸÑÿ™ŸÅÿßÿ≠ ÿßŸÑŸÜÿßÿ∂ÿ¨ ŸäŸÉŸàŸÜ ÿ£ÿ≠ŸÖÿ±' }
                ]);

                this.addQuestions('general', 'medium', [
                    { question: 'ŸÖŸÜ ŸáŸà ŸÖÿ§ŸÑŸÅ ŸÉÿ™ÿßÿ® "ÿßŸÑÿ£ŸÖŸäÿ±"ÿü', answers: ['ÿ¥ŸÉÿ≥ÿ®Ÿäÿ±', 'ÿ£ŸÅŸÑÿßÿ∑ŸàŸÜ', 'ŸÖŸäŸÉÿßŸÅŸäŸÑŸä', 'ÿ£ÿ±ÿ≥ÿ∑Ÿà'], correct: 2, hint: 'ŸÉÿßÿ™ÿ® ÿ•Ÿäÿ∑ÿßŸÑŸä ŸÖŸÜ ÿπÿµÿ± ÿßŸÑŸÜŸáÿ∂ÿ©', explanation: 'ŸÜŸäŸÉŸàŸÑŸà ŸÖŸäŸÉÿßŸÅŸäŸÑŸä ŸÅŸäŸÑÿ≥ŸàŸÅ ŸàŸÉÿßÿ™ÿ® ÿ•Ÿäÿ∑ÿßŸÑŸä' }
                ]);

                // ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ™ÿßÿ±ŸäÿÆŸäÿ©
                this.addQuestions('history', 'easy', [
                    { question: 'ŸÅŸä ÿ£Ÿä ÿ≥ŸÜÿ© Ÿáÿ¨ÿ±Ÿäÿ© ÿ≠ÿØÿ´ÿ™ ŸÖÿπÿ±ŸÉÿ© ÿ®ÿØÿ±ÿü', answers: ['ÿ≥ŸÜÿ© 4 ŸáŸÄ', 'ÿ≥ŸÜÿ© 3 ŸáŸÄ', 'ÿ≥ŸÜÿ© 2 ŸáŸÄ', 'ÿ≥ŸÜÿ© 1 ŸáŸÄ'], correct: 2, hint: 'ŸÅŸä ÿßŸÑÿπÿßŸÖ ÿßŸÑÿ´ÿßŸÜŸä ŸÑŸÑŸáÿ¨ÿ±ÿ©', explanation: 'ÿ≠ÿØÿ´ÿ™ ŸÖÿπÿ±ŸÉÿ© ÿ®ÿØÿ± ÿßŸÑŸÉÿ®ÿ±Ÿâ ŸÅŸä ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ© ŸÑŸÑŸáÿ¨ÿ±ÿ©' }
                ]);

                // ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿ©
                this.addQuestions('geography', 'easy', [
                    { question: 'ŸÖÿß ŸáŸä ÿ£ŸÉÿ®ÿ± ÿØŸàŸÑÿ© ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖ ŸÖŸÜ ÿ≠Ÿäÿ´ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ©ÿü', answers: ['ÿßŸÑŸàŸÑÿßŸäÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ÿØÿ©', 'ÿßŸÑÿµŸäŸÜ', 'ŸÉŸÜÿØÿß', 'ÿ±Ÿàÿ≥Ÿäÿß'], correct: 3, hint: 'ÿ™ŸÖÿ™ÿØ ÿ®ŸäŸÜ ŸÇÿßÿ±ÿ™Ÿä ÿ£Ÿàÿ±Ÿàÿ®ÿß Ÿàÿ¢ÿ≥Ÿäÿß', explanation: 'ÿ±Ÿàÿ≥Ÿäÿß ÿ™ÿ®ŸÑÿ∫ ŸÖÿ≥ÿßÿ≠ÿ™Ÿáÿß ÿ≠ŸàÿßŸÑŸä 17 ŸÖŸÑŸäŸàŸÜ ŸÉŸÖ¬≤' }
                ]);

                this.saveQuestions();
            }

            addQuestions(categoryId, difficulty, questions) {
                if (!this.categories[categoryId]) {
                    console.error(`‚ùå ÿßŸÑÿ™ÿµŸÜŸäŸÅ ${categoryId} ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ`);
                    return;
                }
                questions.forEach((q, index) => {
                    const questionId = `${categoryId}_${difficulty}_${Date.now()}_${index}`;
                    const fullQuestion = {
                        id: questionId,
                        question: q.question,
                        answers: q.answers,
                        correct: q.correct,
                        hint: q.hint || '',
                        explanation: q.explanation || '',
                        category: categoryId,
                        difficulty: difficulty,
                        points: this.getPointsForDifficulty(difficulty),
                        createdAt: new Date().toISOString()
                    };
                    this.categories[categoryId].questions[difficulty].push(fullQuestion);
                });
            }

            getPointsForDifficulty(difficulty) {
                const points = { easy: 100, medium: 300, hard: 500 };
                return points[difficulty] || 100;
            }

            saveQuestions() {
                try {
                    const data = { categories: this.categories, lastUpdated: new Date().toISOString() };
                    localStorage.setItem(GameConfig.STORAGE_KEYS.QUESTIONS, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©:', error);
                    return false;
                }
            }

            getRandomQuestion(categoryId, difficulty) {
                if (!this.categories[categoryId] || !this.categories[categoryId].questions[difficulty]) {
                    return this.getFallbackQuestion();
                }
                const questions = this.categories[categoryId].questions[difficulty];
                const availableQuestions = questions.filter(q => !this.usedQuestions.has(q.id));
                if (availableQuestions.length === 0) {
                    this.usedQuestions.clear();
                    return this.getRandomQuestion(categoryId, difficulty);
                }
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                const question = availableQuestions[randomIndex];
                this.usedQuestions.add(question.id);
                return question;
            }

            getGameQuestions(categories, difficulty, count = 15) {
                const questions = [];
                const easyCount = Math.floor(count * 0.5);
                const mediumCount = Math.floor(count * 0.3);
                const hardCount = count - easyCount - mediumCount;

                for (let i = 0; i < easyCount; i++) {
                    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                    const question = this.getRandomQuestion(randomCategory, 'easy');
                    if (question) questions.push(question);
                }

                for (let i = 0; i < mediumCount; i++) {
                    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                    const question = this.getRandomQuestion(randomCategory, 'medium');
                    if (question) questions.push(question);
                }

                for (let i = 0; i < hardCount; i++) {
                    const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                    const question = this.getRandomQuestion(randomCategory, 'hard');
                    if (question) questions.push(question);
                }

                return this.shuffleArray(questions).slice(0, count);
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            getFallbackQuestion() {
                return {
                    id: 'fallback',
                    question: 'ŸÖÿß ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿßÿü',
                    answers: ['ÿ±ŸàŸÖÿß', 'ÿ®ÿßÿ±Ÿäÿ≥', 'ÿ®ÿ±ŸÑŸäŸÜ', 'ŸÑŸÜÿØŸÜ'],
                    correct: 1,
                    hint: 'ÿ™ÿ¥ÿ™Ÿáÿ± ÿ®ÿ®ÿ±ÿ¨ ÿ•ŸäŸÅŸÑ',
                    explanation: 'ÿ®ÿßÿ±Ÿäÿ≥ ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿß',
                    category: 'general',
                    difficulty: 'easy',
                    points: 100
                };
            }

            getAllQuestions() {
                const allQuestions = [];
                for (const categoryId in this.categories) {
                    for (const difficulty in this.categories[categoryId].questions) {
                        this.categories[categoryId].questions[difficulty].forEach(q => {
                            allQuestions.push({ ...q, categoryName: this.categories[categoryId].name });
                        });
                    }
                }
                return allQuestions;
            }

            searchQuestions(query) {
                const results = [];
                const searchQuery = query.toLowerCase();
                for (const categoryId in this.categories) {
                    for (const difficulty in this.categories[categoryId].questions) {
                        this.categories[categoryId].questions[difficulty].forEach(q => {
                            if (q.question.toLowerCase().includes(searchQuery) || q.category.toLowerCase().includes(searchQuery)) {
                                results.push({ ...q, categoryName: this.categories[categoryId].name });
                            }
                        });
                    }
                }
                return results;
            }

            addQuestion(questionData) {
                const questionId = `${questionData.category}_${questionData.difficulty}_${Date.now()}`;
                const newQuestion = {
                    id: questionId,
                    question: questionData.question,
                    answers: questionData.answers,
                    correct: questionData.correct,
                    hint: questionData.hint || '',
                    explanation: questionData.explanation || '',
                    category: questionData.category,
                    difficulty: questionData.difficulty,
                    points: this.getPointsForDifficulty(questionData.difficulty),
                    createdAt: new Date().toISOString()
                };
                if (!this.categories[questionData.category]) {
                    console.error('‚ùå ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
                    return false;
                }
                this.categories[questionData.category].questions[questionData.difficulty].push(newQuestion);
                return this.saveQuestions();
            }

            deleteQuestion(questionId) {
                for (const categoryId in this.categories) {
                    for (const difficulty in this.categories[categoryId].questions) {
                        const questions = this.categories[categoryId].questions[difficulty];
                        const index = questions.findIndex(q => q.id === questionId);
                        if (index !== -1) {
                            questions.splice(index, 1);
                            return this.saveQuestions();
                        }
                    }
                }
                return false;
            }

            resetUsedQuestions() { this.usedQuestions.clear(); }
        }

        // ===== GameEngine =====
        class GameEngine {
            constructor() {
                this.currentGame = null;
                this.timer = null;
                this.isActive = false;
                console.log('‚úÖ ŸÖÿ≠ÿ±ŸÉ ÿßŸÑŸÑÿπÿ®ÿ© ÿ¨ÿßŸáÿ≤');
            }

            startNewGame(options = {}) {
                this.stopGame();
                this.currentGame = {
                    id: 'game_' + Date.now(),
                    status: 'active',
                    player: options.player || 'ŸÑÿßÿπÿ®',
                    difficulty: options.difficulty || 'medium',
                    categories: options.categories || ['general'],
                    currentQuestion: 0,
                    score: 0,
                    correctAnswers: 0,
                    totalQuestions: options.totalQuestions || GameConfig.MAX_QUESTIONS,
                    questions: [],
                    startTime: Date.now(),
                    endTime: null,
                    timeLeft: this.getTimeForDifficulty(options.difficulty || 'medium'),
                    lifelines: this.getLifelinesForDifficulty(options.difficulty || 'medium'),
                    usedLifelines: [],
                    timerEnabled: options.timerEnabled !== false
                };

                if (window.questionManager) {
                    const questionManager = new QuestionManager();
                    this.currentGame.questions = questionManager.getGameQuestions(
                        this.currentGame.categories,
                        this.currentGame.difficulty,
                        this.currentGame.totalQuestions
                    );
                } else {
                    this.currentGame.questions = this.getDefaultQuestions();
                }

                this.isActive = true;
                if (this.currentGame.timerEnabled) {
                    this.startTimer();
                }

                console.log(`üéÆ ÿ®ÿØÿ£ÿ™ ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©: ${this.currentGame.id}`);
                return { success: true, game: this.currentGame, firstQuestion: this.getCurrentQuestion() };
            }

            getTimeForDifficulty(difficulty) {
                const level = GameConfig.DIFFICULTY_LEVELS.find(l => l.id === difficulty);
                return level ? level.time : 45;
            }

            getLifelinesForDifficulty(difficulty) {
                const level = GameConfig.DIFFICULTY_LEVELS.find(l => l.id === difficulty);
                return level ? level.lifelines : 2;
            }

            getCurrentQuestion() {
                if (!this.currentGame || !this.isActive) return null;
                if (this.currentGame.currentQuestion >= this.currentGame.questions.length) return null;
                const question = this.currentGame.questions[this.currentGame.currentQuestion];
                return {
                    ...question,
                    questionNumber: this.currentGame.currentQuestion + 1,
                    totalQuestions: this.currentGame.totalQuestions,
                    timeLeft: this.currentGame.timeLeft,
                    score: this.getCurrentScore()
                };
            }

            getCurrentScore() {
                if (!this.currentGame) return 0;
                let score = this.currentGame.score;
                const currentQuestionIndex = this.currentGame.currentQuestion;
                if (currentQuestionIndex < GameConfig.PRIZES.length) {
                    score += GameConfig.PRIZES[currentQuestionIndex];
                }
                return score;
            }

            selectAnswer(answerIndex) {
                if (!this.isActive || !this.currentGame) {
                    return { success: false, message: 'ÿßŸÑŸÑÿπÿ®ÿ© ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑ÿ©' };
                }
                const currentQuestion = this.currentGame.questions[this.currentGame.currentQuestion];
                if (answerIndex < 0 || answerIndex >= currentQuestion.answers.length) {
                    return { success: false, message: 'ÿ•ÿ¨ÿßÿ®ÿ© ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©' };
                }
                this.stopTimer();
                const isCorrect = (answerIndex === currentQuestion.correct);
                if (isCorrect) {
                    this.currentGame.score += this.getQuestionPoints();
                    this.currentGame.correctAnswers++;
                }
                currentQuestion.userAnswer = answerIndex;
                return { success: true, isCorrect: isCorrect, correctAnswer: currentQuestion.correct, explanation: currentQuestion.explanation, score: this.currentGame.score };
            }

            getQuestionPoints() {
                const questionIndex = this.currentGame.currentQuestion;
                if (questionIndex < GameConfig.PRIZES.length) {
                    return GameConfig.PRIZES[questionIndex];
                }
                return 100;
            }

            nextQuestion() {
                if (!this.isActive || !this.currentGame) {
                    return { success: false, message: 'ÿßŸÑŸÑÿπÿ®ÿ© ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑ÿ©' };
                }
                this.currentGame.currentQuestion++;
                if (this.currentGame.currentQuestion >= this.currentGame.totalQuestions) {
                    return this.finishGame();
                }
                this.currentGame.timeLeft = this.getTimeForDifficulty(this.currentGame.difficulty);
                if (this.currentGame.timerEnabled) {
                    this.startTimer();
                }
                return { success: true, question: this.getCurrentQuestion() };
            }

            startTimer() {
                if (!this.currentGame || !this.currentGame.timerEnabled) return;
                this.timer = setInterval(() => {
                    if (!this.currentGame || !this.isActive) {
                        this.stopTimer();
                        return;
                    }
                    this.currentGame.timeLeft--;
                    if (this.currentGame.timeLeft <= 10) {
                        // ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ÿµŸàÿ™ ÿ™ŸÜÿ®ŸäŸá ŸáŸÜÿß
                    }
                    if (this.currentGame.timeLeft <= 0) {
                        this.handleTimeUp();
                    }
                }, 1000);
            }

            stopTimer() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
            }

            handleTimeUp() {
                this.stopTimer();
                if (this.isActive && this.currentGame) {
                    const wrongAnswerIndex = (this.currentGame.questions[this.currentGame.currentQuestion].correct + 1) % 4;
                    this.selectAnswer(wrongAnswerIndex);
                }
            }

            finishGame() {
                this.stopTimer();
                if (!this.currentGame) {
                    return { success: false, message: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÑÿπÿ®ÿ© ŸÜÿ¥ÿ∑ÿ©' };
                }
                this.isActive = false;
                this.currentGame.status = 'finished';
                this.currentGame.endTime = Date.now();
                const totalTime = Math.floor((this.currentGame.endTime - this.currentGame.startTime) / 1000);
                const accuracy = this.currentGame.totalQuestions > 0 ? Math.round((this.currentGame.correctAnswers / this.currentGame.totalQuestions) * 100) : 0;
                const result = {
                    success: true,
                    gameResult: {
                        score: this.currentGame.score,
                        correctAnswers: this.currentGame.correctAnswers,
                        totalQuestions: this.currentGame.totalQuestions,
                        totalTime: totalTime,
                        accuracy: accuracy,
                        isWin: this.currentGame.correctAnswers === this.currentGame.totalQuestions,
                        difficulty: this.currentGame.difficulty,
                        finalPrize: this.currentGame.score
                    }
                };
                console.log('üèÅ ÿßŸÑŸÑÿπÿ®ÿ© ÿßŸÜÿ™Ÿáÿ™:', result);
                return result;
            }

            stopGame() {
                this.stopTimer();
                this.isActive = false;
                this.currentGame = null;
            }

            getDefaultQuestions() {
                return [
                    { question: 'ŸÖÿß ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿßÿü', answers: ['ÿ±ŸàŸÖÿß', 'ÿ®ÿßÿ±Ÿäÿ≥', 'ÿ®ÿ±ŸÑŸäŸÜ', 'ŸÑŸÜÿØŸÜ'], correct: 1, hint: 'ÿ™ÿ¥ÿ™Ÿáÿ± ÿ®ÿ®ÿ±ÿ¨ ÿ•ŸäŸÅŸÑ', explanation: 'ÿ®ÿßÿ±Ÿäÿ≥ ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿß', category: 'general', difficulty: 'easy', points: 100 },
                    { question: 'ŸÉŸÖ ÿπÿØÿØ ŸÉŸàÿßŸÉÿ® ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿ©ÿü', answers: ['7', '8', '9', '10'], correct: 1, hint: 'ÿ®ŸÖÿß ŸÅŸä ÿ∞ŸÑŸÉ ÿßŸÑÿ£ÿ±ÿ∂', explanation: 'ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿ© ŸÑŸáÿß 8 ŸÉŸàÿßŸÉÿ®', category: 'science', difficulty: 'easy', points: 100 }
                ];
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
        }

        // ===== UIManager =====
        class UIManager {
            constructor(appInstance) {
                this.app = appInstance;
                this.currentScreen = 'auth';
                this.notifications = [];
                console.log('‚úÖ ŸÖÿØŸäÿ± ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ¨ÿßŸáÿ≤');
            }

            showScreen(screenName) {
                const screens = ['auth', 'main-menu', 'game', 'admin', 'results'];
                screens.forEach(screen => {
                    const element = document.getElementById(`${screen}-screen`);
                    if (element) element.classList.remove('active');
                });
                const targetScreen = document.getElementById(`${screenName}-screen`);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    this.currentScreen = screenName;
                }
            }

            updateUserDisplay(user) {
                const welcomeEl = document.querySelector('.user-welcome');
                const balanceEl = document.querySelector('.stat-value');
                if (welcomeEl) welcomeEl.textContent = `ŸÖÿ±ÿ≠ÿ®ÿßŸã ${user.username}!`;
                if (balanceEl) balanceEl.textContent = `${user.balance?.toLocaleString() || 0} $`;
            }

            createGameScreen(question) {
                const gameScreen = document.getElementById('game-screen');
                if (!gameScreen || !question) return;
                gameScreen.innerHTML = `
                    <div style="max-width: 1000px; width: 100%;">
                        <div class="game-header">
                            <div class="player-info">
                                <div class="player-avatar">üëë</div>
                                <div class="player-details">
                                    <h3>${this.app.auth.getCurrentUser()?.username || 'ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥'}</h3>
                                    <p>ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${this.app.auth.getCurrentUser()?.stats?.level || 1}</p>
                                </div>
                            </div>
                            <div class="game-stats">
                                <div class="stat-box">
                                    <div class="stat-label">ÿßŸÑŸàŸÇÿ™</div>
                                    <div class="stat-value" id="timer-display">${question.timeLeft}</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-label">ÿßŸÑÿ±ÿµŸäÿØ</div>
                                    <div class="stat-value" id="score-display">${this.app.game.currentGame?.score || 0} $</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-label">ÿßŸÑÿ≥ÿ§ÿßŸÑ</div>
                                    <div class="stat-value">${question.questionNumber}/${question.totalQuestions}</div>
                                </div>
                            </div>
                        </div>
                        <div class="question-box">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #FFD700; color: black; padding: 10px 20px; border-radius: 20px; font-weight: bold;">ÿßŸÑÿ¨ÿßÿ¶ÿ≤ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©</div>
                                <div style="color: #FFD700; font-size: 1.8rem; font-weight: bold;">${this.calculatePrize(question.questionNumber).toLocaleString()} $</div>
                            </div>
                            <h2 class="question-text">${question.question}</h2>
                            <div class="answers-grid" id="answers-container">
                                ${question.answers.map((answer, index) => `
                                    <button class="answer-btn" data-answer="${index}">
                                        <div class="answer-letter">${String.fromCharCode(65 + index)}</div>
                                        <div class="answer-text">${answer}</div>
                                    </button>
                                `).join('')}
                            </div>
                            <div style="margin-top: 30px;">
                                <div class="hint-box" id="hint-box" style="display: none; background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 10px; border-right: 4px solid #3498db;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-lightbulb" style="color: #3498db;"></i>
                                        <div id="hint-text" style="color: #ddd;"></div>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 30px; flex-wrap: wrap; gap: 10px;">
                                <button class="btn btn-secondary" id="quit-game"><i class="fas fa-sign-out-alt"></i> ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÑÿπÿ®ÿ©</button>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-primary" id="show-hint"><i class="fas fa-lightbulb"></i> ÿ™ŸÑŸÖŸäÿ≠</button>
                                    <button class="btn btn-primary" id="next-question" disabled><i class="fas fa-arrow-left"></i> ÿßŸÑÿ™ÿßŸÑŸä</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                this.setupGameEvents(question);
            }

            setupGameEvents(question) {
                document.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const answerIndex = parseInt(e.currentTarget.dataset.answer);
                        const result = this.app.game.selectAnswer(answerIndex);
                        if (result.success) {
                            this.highlightAnswers(answerIndex, result.correctAnswer);
                            setTimeout(() => {
                                this.showNotification(result.isCorrect ? 'üéâ ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©!' : '‚ùå ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©!', result.isCorrect ? 'success' : 'error');
                                if (!result.isCorrect && result.explanation) {
                                    document.getElementById('hint-text').textContent = result.explanation;
                                    document.getElementById('hint-box').style.display = 'block';
                                }
                            }, 500);
                            document.getElementById('next-question').disabled = false;
                        }
                    });
                });
                document.getElementById('next-question')?.addEventListener('click', () => {
                    const result = this.app.game.nextQuestion();
                    if (result.success && result.question) {
                        this.createGameScreen(result.question);
                    } else if (result.success && result.gameResult) {
                        this.showResults(result.gameResult);
                    }
                });
                document.getElementById('quit-game')?.addEventListener('click', () => {
                    if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÑÿπÿ®ÿ©ÿü ÿ≥Ÿäÿ™ŸÖ ŸÅŸÇÿØÿßŸÜ ÿ™ŸÇÿØŸÖŸÉ ÿßŸÑÿ≠ÿßŸÑŸä.')) {
                        this.app.game.stopGame();
                        this.app.showMainMenu();
                    }
                });
                document.getElementById('show-hint')?.addEventListener('click', () => {
                    if (question.hint) {
                        document.getElementById('hint-text').textContent = question.hint;
                        document.getElementById('hint-box').style.display = 'block';
                    }
                });
            }

            highlightAnswers(selectedIndex, correctIndex) {
                const buttons = document.querySelectorAll('.answer-btn');
                buttons.forEach((btn, index) => {
                    btn.disabled = true;
                    if (index === correctIndex) btn.classList.add('correct');
                    else if (index === selectedIndex) btn.classList.add('wrong');
                });
            }

            calculatePrize(questionNumber) {
                if (questionNumber - 1 < GameConfig.PRIZES.length) {
                    return GameConfig.PRIZES[questionNumber - 1];
                }
                return 100;
            }

            updateTimer(timeLeft) {
                const timerDisplay = document.getElementById('timer-display');
                if (timerDisplay) {
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 10) timerDisplay.style.color = '#e74c3c';
                }
            }

            showResults(results) {
                const resultsScreen = document.getElementById('results-screen');
                if (!resultsScreen) return;
                resultsScreen.innerHTML = `
                    <div class="results-container">
                        <div class="result-icon">${results.isWin ? 'üéâ' : 'üí´'}</div>
                        <h1 style="color: #FFD700; margin-bottom: 10px;">${results.isWin ? 'ŸÖÿ®ÿ±ŸàŸÉ! ŸÑŸÇÿØ ŸÅÿ≤ÿ™!' : 'ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©!'}</h1>
                        <p style="color: #aaa; margin-bottom: 30px;">${results.isWin ? 'ŸÑŸÇÿØ ŸÅÿ≤ÿ™ ÿ®ŸÖŸÑŸäŸàŸÜ ÿØŸàŸÑÿßÿ±!' : 'ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÑŸÑŸÅŸàÿ≤ ÿ®ÿßŸÑŸÖŸÑŸäŸàŸÜ!'}</p>
                        <div style="background: rgba(212, 175, 55, 0.1); padding: 30px; border-radius: 20px; margin: 30px 0;">
                            <div style="font-size: 3.5rem; color: #FFD700; font-weight: bold;">${results.finalPrize.toLocaleString()} $</div>
                            <div style="color: #aaa; margin-top: 10px;">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÜŸáÿßÿ¶Ÿä</div>
                        </div>
                        <div class="results-stats">
                            <div class="result-stat"><div class="stat-icon">‚úÖ</div><div class="stat-value">${results.correctAnswers}/${results.totalQuestions}</div><div class="stat-label">ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©</div></div>
                            <div class="result-stat"><div class="stat-icon">üéØ</div><div class="stat-value">${results.accuracy}%</div><div class="stat-label">ÿßŸÑÿØŸÇÿ©</div></div>
                            <div class="result-stat"><div class="stat-icon">‚è±Ô∏è</div><div class="stat-value">${Math.floor(results.totalTime / 60)}:${(results.totalTime % 60).toString().padStart(2, '0')}</div><div class="stat-label">ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÉŸÑŸä</div></div>
                            <div class="result-stat"><div class="stat-icon">üìä</div><div class="stat-value">${results.difficulty}</div><div class="stat-label">ÿßŸÑÿµÿπŸàÿ®ÿ©</div></div>
                        </div>
                        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                            <button class="btn btn-primary" id="play-again"><i class="fas fa-redo"></i> ŸÑÿπÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ</button>
                            <button class="btn btn-secondary" id="back-to-menu"><i class="fas fa-home"></i> ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</button>
                            <button class="btn btn-secondary" id="share-results"><i class="fas fa-share-alt"></i> ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨</button>
                        </div>
                    </div>
                `;
                this.showScreen('results');
                document.getElementById('play-again')?.addEventListener('click', () => { this.app.startNewGame(); });
                document.getElementById('back-to-menu')?.addEventListener('click', () => { this.app.showMainMenu(); });
                document.getElementById('share-results')?.addEventListener('click', () => { this.shareResults(results); });
            }

            shareResults(results) {
                const text = `üéÆ ŸÑÿπÿ®ÿ© ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©\nÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©: ${results.finalPrize.toLocaleString()} $\nÿßŸÑÿØŸÇÿ©: ${results.accuracy}%\nÿßŸÑŸàŸÇÿ™: ${Math.floor(results.totalTime / 60)}:${(results.totalTime % 60).toString().padStart(2, '0')}\n\nÿ£ÿ¨ÿ± ÿ® ÿßŸÑŸÑÿπÿ®ÿ© ÿßŸÑÿ¢ŸÜ!`;
                if (navigator.share) {
                    navigator.share({ title: "ŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©", text: text, url: window.location.href });
                } else {
                    navigator.clipboard.writeText(text);
                    this.showNotification("ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿßŸÅÿ∏ÿ©", 'success');
                }
            }

            showNotification(message, type = 'info') {
                this.notifications.forEach(notif => {
                    if (notif.element && notif.element.parentNode) notif.element.remove();
                });
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 1.5rem;">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</div>
                        <div>${message}</div>
                        <button style="background: none; border: none; color: white; cursor: pointer; margin-right: auto;">‚úñ</button>
                    </div>
                `;
                notification.querySelector('button').addEventListener('click', () => notification.remove());
                const notifObj = { element: notification, timeout: null };
                this.notifications.push(notifObj);
                document.body.appendChild(notification);
                notifObj.timeout = setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.opacity = '0';
                        notification.style.transition = 'opacity 0.5s';
                        setTimeout(() => notification.remove(), 500);
                    }
                }, 5000);
            }

            flashEffect(type) {
                const flash = document.createElement('div');
                flash.className = `flash ${type}`;
                document.body.appendChild(flash);
                setTimeout(() => { if (flash.parentNode) flash.remove(); }, 1000);
            }
        }

        // ===== MillionaireApp (ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä) =====
        class MillionaireApp {
            constructor() {
                console.log("üöÄ ÿ®ÿØÿ° ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿä...");
                try {
                    // ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸÉŸàŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
                    this.auth = new AuthSystem();
                    this.questions = new QuestionManager();
                    this.game = new GameEngine();
                    this.ui = new UIManager(this);
                    
                    // ÿ•ŸÜÿ¥ÿßÿ° Ÿàÿßÿ¨Ÿáÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                    this.createScreens();
                    
                    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                    this.checkUser();
                    
                    // ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
                    this.setupEvents();
                    
                    // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≥ÿ§ŸàŸÑ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
                    this.createDefaultAdmin();
                    
                    console.log("‚úÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ");
                    
                    // ÿ•ÿÆŸÅÿßÿ° ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
                    setTimeout(() => {
                        document.getElementById('loading').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('loading').style.display = 'none';
                            document.getElementById('app').style.display = 'block';
                        }, 500);
                    }, 2000);
                    
                } catch (error) {
                    console.error("‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:", error);
                    this.showError(error);
                }
            }

            createScreens() {
                const app = document.getElementById('app');
                app.innerHTML = `
                    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÖÿµÿßÿØŸÇÿ© -->
                    <div id="auth-screen" class="screen active">
                        <div class="auth-box">
                            <h1 style="text-align: center; color: #FFD700; margin-bottom: 30px; font-size: 2.5rem;">
                                <i class="fas fa-crown"></i> ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿä
                            </h1>
                            <p style="text-align: center; color: #aaa; margin-bottom: 30px;">ÿßÿÆÿ™ÿ®ÿ± ÿ∞ŸÉÿßÿ°ŸÉ ŸÑŸÑŸÅŸàÿ≤ ÿ®ŸÖŸÑŸäŸàŸÜ ÿØŸàŸÑÿßÿ±</p>
                            <div class="auth-tabs">
                                <button class="auth-tab active" data-tab="login">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
                                <button class="auth-tab" data-tab="register">ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®</button>
                            </div>
                            <form id="login-form" class="auth-form active">
                                <div class="form-group">
                                    <label for="login-username"><i class="fas fa-user"></i> ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
                                    <input type="text" id="login-username" class="form-control" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ" required>
                                </div>
                                <div class="form-group">
                                    <label for="login-password"><i class="fas fa-lock"></i> ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                                    <input type="password" id="login-password" class="form-control" placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" required>
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                                    <i class="fas fa-sign-in-alt"></i> ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
                                </button>
                                <p style="text-align: center; margin-top: 20px; color: #aaa;">
                                    <a href="#" id="admin-login-link" style="color: #FFD700; text-decoration: none;">
                                        <i class="fas fa-user-shield"></i> ÿßŸÑÿØÿÆŸàŸÑ ŸÉŸÖÿ≥ÿ§ŸàŸÑ (admin / Admin@2024)
                                    </a>
                                </p>
                            </form>
                            <form id="register-form" class="auth-form">
                                <div class="form-group">
                                    <label for="register-username"><i class="fas fa-user-plus"></i> ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
                                    <input type="text" id="register-username" class="form-control" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨ÿØŸäÿØ" required>
                                </div>
                                <div class="form-group">
                                    <label for="register-password"><i class="fas fa-lock"></i> ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                                    <input type="password" id="register-password" class="form-control" placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÇŸàŸäÿ©" required>
                                </div>
                                <div class="form-group">
                                    <label for="register-email"><i class="fas fa-envelope"></i> ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                                    <input type="email" id="register-email" class="form-control" placeholder="example@email.com">
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                                    <i class="fas fa-user-plus"></i> ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
                    <div id="main-menu-screen" class="screen">
                        <div class="menu-container">
                            <div class="user-header">
                                <h1 id="welcome-text" class="user-welcome">ŸÖÿ±ÿ≠ÿ®ÿßŸã!</h1>
                                <p style="color: #FFD700; font-size: 1.2rem;">ÿßÿ≥ÿ™ÿπÿØ ŸÑŸÑŸÅŸàÿ≤ ÿ®ŸÖŸÑŸäŸàŸÜ ÿØŸàŸÑÿßÿ±</p>
                                <div class="user-stats">
                                    <div class="stat-item">
                                        <div id="balance-display" class="stat-value">0 $</div>
                                        <div class="stat-label">ÿßŸÑÿ±ÿµŸäÿØ</div>
                                    </div>
                                    <div class="stat-item">
                                        <div id="level-display" class="stat-value">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 1</div>
                                        <div class="stat-label">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ</div>
                                    </div>
                                    <div class="stat-item">
                                        <div id="highscore-display" class="stat-value">0</div>
                                        <div class="stat-label">ÿ£ÿπŸÑŸâ ŸÜÿ™Ÿäÿ¨ÿ©</div>
                                    </div>
                                    <div class="stat-item">
                                        <div id="games-played-display" class="stat-value">0</div>
                                        <div class="stat-label">ÿπÿØÿØ ÿßŸÑÿ£ŸÑÿπÿßÿ®</div>
                                    </div>
                                </div>
                            </div>
                            <div class="menu-grid">
                                <div class="menu-card" id="play-btn">
                                    <div class="menu-icon">üéÆ</div>
                                    <h3>ÿ®ÿØÿ£ ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©</h3>
                                    <p>ÿ•ÿ®ÿØÿ£ ÿ™ÿ≠ÿØŸä ÿßŸÑŸÖŸÑŸäŸàŸÜ ÿØŸàŸÑÿßÿ± ŸÖÿπ 15 ÿ≥ÿ§ÿßŸÑÿßŸã ŸÖÿ™ÿ™ÿßŸÑŸäÿßŸã</p>
                                </div>
                                <div class="menu-card" id="categories-btn">
                                    <div class="menu-icon">üìö</div>
                                    <h3>ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™</h3>
                                    <p>ÿßÿÆÿ™ÿ± ŸÖŸàÿßÿ∂Ÿäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ±ŸäÿØ ÿßŸÑÿ™ÿ≠ÿØŸä ŸÅŸäŸáÿß</p>
                                </div>
                                <div class="menu-card" id="leaderboard-btn">
                                    <div class="menu-icon">üèÜ</div>
                                    <h3>ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ</h3>
                                    <p>ÿ¥ÿßŸáÿØ ÿ£ŸÅÿ∂ŸÑ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ Ÿàÿ™ŸÜÿßŸÅÿ≥ ÿπŸÑŸâ ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ£ŸàŸÑ</p>
                                </div>
                                <div class="menu-card" id="settings-btn">
                                    <div class="menu-icon">‚öôÔ∏è</div>
                                    <h3>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</h3>
                                    <p>ÿ™ÿÆÿµŸäÿµ ÿßŸÑÿµŸàÿ™ÿå ÿßŸÑŸÖÿ∏Ÿáÿ±ÿå Ÿàÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©</p>
                                </div>
                                <div class="menu-card" id="logout-btn">
                                    <div class="menu-icon">üö™</div>
                                    <h3>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</h3>
                                    <p>ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿ≠ÿ≥ÿßÿ®ŸÉ ŸàÿßŸÑÿπŸàÿØÿ© ŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ®ÿØÿßŸäÿ©</p>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 40px; color: #777;">
                                <p>ÿßŸÑÿ•ÿµÿØÿßÿ± ${GameConfig.VERSION} | ÿßŸÑŸÖŸÑŸäŸàŸÜŸäÿ± ÿßŸÑÿ∞Ÿáÿ®Ÿä ¬© ${new Date().getFullYear()}</p>
                            </div>
                        </div>
                    </div>

                    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÑÿπÿ®ÿ© -->
                    <div id="game-screen" class="screen"></div>

                    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ -->
                    <div id="results-screen" class="screen"></div>
                `;
            }

            checkUser() {
                if (this.auth.isLoggedIn()) {
                    this.showMainMenu();
                } else {
                    this.ui.showScreen('auth');
                }
            }

            showMainMenu() {
                const user = this.auth.getCurrentUser();
                if (!user) {
                    this.ui.showScreen('auth');
                    return;
                }
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
                document.getElementById('welcome-text').textContent = `ŸÖÿ±ÿ≠ÿ®ÿßŸã ${user.username}!`;
                document.getElementById('balance-display').textContent = `${user.balance?.toLocaleString() || 0} $`;
                document.getElementById('level-display').textContent = `ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${user.stats?.level || 1}`;
                document.getElementById('highscore-display').textContent = (user.stats?.highestScore || 0).toLocaleString();
                document.getElementById('games-played-display').textContent = user.stats?.gamesPlayed || 0;
                
                this.ui.showScreen('main-menu');
                this.setupMainMenuEvents();
            }

            setupMainMenuEvents() {
                document.getElementById('play-btn')?.addEventListener('click', () => this.startNewGame());
                document.getElementById('categories-btn')?.addEventListener('click', () => this.ui.showNotification('ŸÇÿ±Ÿäÿ®ÿßŸã...', 'info'));
                document.getElementById('leaderboard-btn')?.addEventListener('click', () => this.ui.showNotification('ŸÇÿ±Ÿäÿ®ÿßŸã...', 'info'));
                document.getElementById('settings-btn')?.addEventListener('click', () => this.ui.showNotification('ŸÇÿ±Ÿäÿ®ÿßŸã...', 'info'));
                document.getElementById('logout-btn')?.addEventListener('click', () => {
                    this.auth.logout();
                    this.ui.showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    this.checkUser();
                });
            }

            setupEvents() {
                // ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('auth-tab')) {
                        const tab = e.target.dataset.tab;
                        this.showAuthTab(tab);
                    }
                    if (e.target.id === 'admin-login-link') {
                        e.preventDefault();
                        this.showAdminLogin();
                    }
                });

                // ÿ£ÿ≠ÿØÿßÿ´ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const activeAuthForm = document.querySelector('.auth-form.active');
                        if (activeAuthForm) {
                            e.preventDefault();
                            if (activeAuthForm.id === 'login-form') this.handleLogin();
                            else this.handleRegister();
                        }
                    }
                });

                document.getElementById('login-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                document.getElementById('register-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegister();
                });
            }

            showAuthTab(tab) {
                const tabs = document.querySelectorAll('.auth-tab');
                const forms = document.querySelectorAll('.auth-form');
                tabs.forEach(t => t.classList.remove('active'));
                forms.forEach(f => f.classList.remove('active'));
                document.querySelector(`.auth-tab[data-tab="${tab}"]`)?.classList.add('active');
                document.getElementById(`${tab}-form`)?.classList.add('active');
            }

            handleLogin() {
                const username = document.getElementById('login-username')?.value.trim();
                const password = document.getElementById('login-password')?.value;
                if (!username || !password) {
                    this.ui.showNotification('ÿßŸÑÿ±ÿ¨ÿßÿ° ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©', 'error');
                    return;
                }
                const result = this.auth.login(username, password);
                if (result.success) {
                    this.ui.showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    setTimeout(() => this.checkUser(), 500);
                } else {
                    this.ui.showNotification(result.message, 'error');
                }
            }

            handleRegister() {
                const username = document.getElementById('register-username')?.value.trim();
                const password = document.getElementById('register-password')?.value;
                const email = document.getElementById('register-email')?.value.trim();
                if (!username || !password) {
                    this.ui.showNotification('ÿßŸÑÿ±ÿ¨ÿßÿ° ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©', 'error');
                    return;
                }
                const result = this.auth.register(username, password, email);
                if (result.success) {
                    this.ui.showNotification('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    setTimeout(() => this.checkUser(), 500);
                } else {
                    this.ui.showNotification(result.message, 'error');
                }
            }

            showAdminLogin() {
                // ÿ™ÿπÿ®ÿ¶ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä
                document.getElementById('login-username').value = 'admin';
                document.getElementById('login-password').value = 'Admin@2024';
                document.querySelector('.auth-tab[data-tab="login"]').click();
                this.ui.showNotification('ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ ŸÖÿπÿ®ÿ£ÿ©ÿå ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ', 'info');
            }

            startNewGame() {
                const user = this.auth.getCurrentUser();
                if (!user) {
                    this.ui.showNotification('Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã', 'error');
                    this.ui.showScreen('auth');
                    return;
                }
                const result = this.game.startNewGame({
                    player: user.username,
                    difficulty: 'medium',
                    categories: ['general'],
                    timerEnabled: true
                });
                if (result.success) {
                    this.ui.showScreen('game');
                    this.ui.createGameScreen(result.firstQuestion);
